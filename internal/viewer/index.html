<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tile38 Map Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet"/>
<style>
* {
  box-sizing: border-box;
}
body, html {
  margin: 0;
  padding: 0;
  border: 0;
  width: 100%;
  height: 100%;
  background: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 20px;
  color: black;
}
table {
  border-collapse: collapse;
}
#controls { padding: 20px }
#controls img { margin-right: 20px; }
#map { height: 100%; }
</style>
<script>
function t38fetch(url, cb)  {
  var req = new XMLHttpRequest();
  req.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      let resp = JSON.parse(this.responseText);
      if (!resp || !resp.ok) {
        throw resp.message;
      } else {
        cb(resp)
      }
    }
  };
  req.open("GET", url, true);
  req.send();
}
window.addEventListener("load", function() {
  t38fetch("/keys+*", function(resp) {
    let list = document.getElementById("collist");
    for (var i = 0; i < resp.keys.length; i++) {
      if (i > 0) {
        list.appendChild(document.createTextNode(" • "));
      }
      let key = resp.keys[i];
      let link = document.createElement("A");
      link.href = "#";
      (function(link, key) {
        link.onclick = function() {
          loadlayer(key)
        }
      })(link, key);
      link.innerText = key
      list.appendChild(link);
    }
  })
})
</script>
</head>
<body>
<table width="100%" height="100%">
<tr><td id="controls">
<a href="https://tile38.com"><img src="/viewer/logo.png" height="40" valign="middle"></a>
Choose Collection:
<span id="collist"></span>
</td></tr>
<tr><td height="100%">
<div id="map"></div>
</td></tr>
</table>
</body>
</html>
<!-- MapLibre GL JS -->
<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
<script>
// Use MapLibre’s public demo style (vector tiles)
const map = new maplibregl.Map({
  container: 'map',
  style: 'https://demotiles.maplibre.org/style.json',
  zoom: -1
});
// Controls (zoom/rotation + geolocate)
map.addControl(new maplibregl.NavigationControl(), 'top-right');
map.addControl(new maplibregl.GeolocateControl({
  positionOptions: { enableHighAccuracy: true },
  trackUserLocation: true
}), 'top-right');
var sources = {}
function loadlayer(key) {
  if (sources[key]) {
    map.removeLayer(key+'-fill-layer');
    map.removeLayer(key+'-circle-layer');
    map.removeSource(key+'-source');
  }
  sources[key] = map.addSource(key+'-source', {
    type: 'vector',
    tiles: [
      // Example MVT URL template (replace with your own endpoint)
      'http://'+window.location.host+'/'+key+'/{z}/{x}/{y}.pbf'
    ],
    minzoom: 0,
    maxzoom: 23
  });
  // Add a layer using the vector tile source
  map.addLayer({
    'id': key+'-circle-layer',
    'type': 'circle',
    'source': key+'-source',
    'source-layer': 'tile38',
    'paint': {
      'circle-radius': 5,
      'circle-color': 'red',
    },
    filter: ['==', ['get', 'type'], 'point']
  });
  // Add a layer using the vector tile source
  map.addLayer({
    'id': key+'-fill-layer',
    'type': 'fill',
    'source': key+'-source',
    'source-layer': 'tile38',
    'paint': {
      'fill-color': '#00ff',
      'fill-opacity': 0.5
    },
    filter: ['==', ['get', 'type'], 'polygon']
  });
}
</script>
